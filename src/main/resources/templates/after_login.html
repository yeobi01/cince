<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>추가 정보 입력</title>
    <!-- 간단한 스타일링을 위해 Tailwind CSS CDN을 사용합니다. -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">

<div class="w-full max-w-md p-8 space-y-6 bg-white rounded-lg shadow-md">
    <h2 class="text-2xl font-bold text-center text-gray-800">추가 정보 입력</h2>
    <p class="text-center text-gray-600">서비스 이용을 위해 추가 정보를 입력해주세요.</p>

    <!-- 폼 데이터는 JavaScript로 처리될 것입니다. -->
    <form class="space-y-6" id="additional-info-form">
        <div>
            <label class="block text-sm font-medium text-gray-700" for="phoneNumber">휴대폰 번호</label>
            <input class="w-full px-3 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" id="phoneNumber" name="phoneNumber" placeholder="010-1234-5678"
                   required
                   type="tel">
        </div>
        <div>
            <button class="w-full px-4 py-2 font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                    type="submit">
                가입 완료
            </button>
        </div>
    </form>
    <div class="text-red-500 text-sm text-center mt-2" id="error-message"></div>
</div>

<script>
    // 폼 요소를 가져옵니다.
    const form = document.getElementById('additional-info-form');
    const errorMessageDiv = document.getElementById('error-message');

    // 폼 제출(submit) 이벤트를 감지합니다.
    form.addEventListener('submit', async (event) => {
        // 1. 폼의 기본 제출 동작(페이지 새로고침)을 막습니다.
        event.preventDefault();
        errorMessageDiv.textContent = ''; // 이전 에러 메시지 초기화

        // 2. 폼 데이터를 FormData 객체로 가져온 후, 일반 JavaScript 객체로 변환합니다.
        const formData = new FormData(form);
        const data = {};
        // FormData의 agreeToTerms는 'on' 또는 undefined 이므로 boolean으로 변환합니다.
        data['phoneNumber'] = formData.get('phoneNumber');


        // 3. fetch API를 사용하여 서버에 POST 요청을 보냅니다.
        try {
            const response = await fetch('/auth/signup/additional-info', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                // 4. JavaScript 객체를 JSON 문자열로 변환하여 요청 본문에 담습니다.
                body: JSON.stringify(data),
            });

            // 5. 서버의 응답을 처리합니다.
            if (response.ok) {
                // 성공 시 (200 OK), 메인 페이지로 리다이렉트합니다.
                // 서버에서 쿠키가 자동으로 설정됩니다.
                alert('회원가입이 완료되었습니다!');
                window.location.href = '/'; // 메인 페이지나 대시보드 페이지로 이동
            } else {
                // 실패 시, 에러 메시지를 표시합니다.
                const errorData = await response.json();
                errorMessageDiv.textContent = errorData.message || '가입 처리 중 오류가 발생했습니다.';
            }
        } catch (error) {
            console.error('Error:', error);
            errorMessageDiv.textContent = '네트워크 오류가 발생했습니다. 다시 시도해주세요.';
        }
    });
</script>

</body>
</html>
